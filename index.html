<!DOCTYPE html>
<html lang="en">
    <head id="zeta">
        <title>okaq</title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=1920,height=1080,initial-scale=1" />
        <meta name="source" content="https://github.com/okaq/okaq.gira" />
        <meta name="author" content="AQ<aq@okaq.com>" />
        <meta name="date" content="2014-06-04" />
        <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAMklEQVR4nGIJWf6fgZaAiaamj1owasGoBaMWjFowasGoBaMWjFowasGoBVQEgAAAAP//qJgCPYgbKBUAAAAASUVORK5CYII=" />
        <style type="text/css">
            html,body{width:1920;height:1080;background-color:rgba(0,0,0,0);}
        </style>
        <script type="text/javascript">
            // ok
        console.log("okaq gria bibi go");
        // async load
        (function() {
         var a = {
            "load": function(e) {
                // console.log(e);
                g.init();
            }
         }
         window.addEventListener("load", a.load, false);
         })();
// game
var g = {
    "init": function() {
        c.init();
        // console.log("rgba: " + c.cssr() + " hsla: " + c.cssh());
        d.init();
        r.clear();
        // console.log(p.end()); // returns "little" on host schlegel
        var start = window.performance.now();
        p.init();
        r.plasma3();
        var end = window.performance.now();
        var delta = (end - start);
        console.log("total render time: " + delta + "ms.");
    }
}
// dom
var d = {
    "init": function() {
        d.w = 1920;
        d.w2 = (d.w / 2.0) >>> 0;
        d.w4 = (d.w / 4.0) >>> 0;
        d.h = 1080;
        d.h2 = (d.h / 2.0) >>> 0;
        d.h4 = (d.h / 4.0) >>> 0;
        d.alpha = document.getElementById("alpha");
        d.beta = {};
        d.beta.can = document.createElement("canvas");
        d.alpha.appendChild(d.beta.can);
        d.beta.con = d.beta.can.getContext("2d");
        // console.log(d.alpha, d.beta);
        d.beta.can.width = d.w;
        d.beta.can.height = d.h;
        d.beta.can.style.position = "absolute";
        d.beta.can.style.left = "0px";
        d.beta.can.style.top = "0px";
    }
}
// render
var r = {
    "clear": function() {
        d.beta.can.width = d.beta.can.width;
        var f0 = Math.random();
        if (f0 < 0.5) {
            d.beta.con.fillStyle = c.cssr();
        } else {
            d.beta.con.fillStyle = c.cssh();
        }
        // d.beta.con.fillRect(0,0,d.w,d.h);
        d.beta.con.fillRect(d.w4,d.h4,d.w2,d.h2);
    },
    "plasma": function() {
        for (var i = 0; i < ((d.w * d.h) / 1); i++) {
            var x0 = i % d.w;
            var y0 = (i / d.w) >>> 0;
            c.hsla[0] = p.data[i];
            d.beta.con.fillStyle = c.cssh(); // fillStyle changes are expensive
            d.beta.con.fillRect(x0,y0,1,1);
        }
    },
    "plasma2": function() {
        for (var i = 0; i < (d.w2*d.h2); i++) {
            var x0 = (i % d.w2) + d.w4;
            var y0 = ((i / d.w2) >>> 0) + d.h4;
            c.rgba[2] = p.data[i];
        }
    },
    "plasma3": function() {
        d.beta.con.putImageData(p.image, d.w4, d.h4);
    }
}
// plasma
var p = {
    "init": function() {
        // p.data = []; // imagedata.data
        // typed uint8array(4) for rgba
        // new ArrayBuffer(image.data.length)
        p.image = d.beta.con.getImageData(d.w4,d.h4,d.w2,d.h2);
        p.data = p.image.data;
        // p.ab = new ArrayBuffer(p.data.length);
        // p.bb = new Uint8Array(p.ab); // rgba
        for (var i = 0; i < (d.w2*d.h2); i++) {
            var x0 = (i % d.w2);
            var y0 = (i / d.w2) >>> 0;
            // var c0 = (x0 * y0) % 255; // moire pattern
            // variables for plasma function:
            // normalized position
            // normalized phase
            // cos(x) = sin(x+pi/2)
            var c0 = (Math.sin(((x0+y0) / (d.w2+d.h2)) * 16.0 * Math.PI) + 1.0) * 31.0; // x-y plasma
            var c1 = (Math.cos((y0 / d.h2) * 8.0 * Math.PI) + 1.0) * 31.0;
            var c2 = (Math.sin(((x0+y0) / (d.w2+d.h2)) * 4.0 * Math.PI) + 1.0) * 31.0;
            var c3 = (Math.cos((y0 / d.h2) * 2.0 * Math.PI) + 1.0) * 31.0;
            var i0 = i * 4;
            p.data[i0] = (c0 + c1 + c2 + c3) >>> 0;
            p.data[i0+1] = c.rgba[1];
            p.data[i0+2] = c.rgba[2];
            p.data[i0+3] = c.rgba[3];
        }
        /*
        for (var i = 0; i < (d.w * d.h); i++) {
            // p.data[i] = c.rb(255);
            var y0 = (i / d.w) >>> 0;
            var x0 = (i % d.w);
            var t0 = (y0 / d.h) * 2 * Math.PI;
            var t1 = (x0 / d.w) * 2 * Math.PI;
            var t2 = Math.sin(t0) + 1.0;
            var t3 = Math.cos(t1) + 1.0;
            var t4 = 255.0 / 4.0;
            p.data[i] = t2 * t4 + t3 * t4;
        }
        */    
    },
    "end": function() {
        // check endianness
        // x86, ARM, usually little-end
        var a0 = new ArrayBuffer(4);
        var b0 = new Uint8Array(a0);
        var c0 = new Uint32Array(a0);
        b0[0] = 0xff;
        b0[1] = 0xee;
        b0[2] = 0xdd;
        b0[3] = 0xcc;
        if (c0[0] == 0xccddeeff) {
            p.order = 0;
            return "little";
        } else if (c0[0] == 0xffeeddcc) {
            p.order = 1;;
            return "big";
        } else {
            throw new Error("byte order indeterminate");
        }
    }
}
// color
var c = {
    "init": function() {
        c.rgba = []; // type'd // instanceof
        c.hsla = [];
        c.shuf();
    },
    "shuf": function() {
        for (var i = 0; i < 4; i++) {
            c.rgba[i] = c.rb(255);
        }
        c.hsla[0] = c.rb(255);
        c.hsla[1] = c.rb(100);
        c.hsla[2] = c.rb(100);
        c.hsla[3] = c.rb(255);
    },
    "rb": function(n0) {
        return ((Math.random() * n0) >>> 0);
    },
    "cssr": function() {
        var s0 = "rgba(";
        for (var i = 0; i < 3; i++) {
            s0 += c.rgba[i].toString();
            s0 += ",";
        }
        s0 += (c.rgba[3] / 255.0).toString();
        s0 += ")";
        return s0;
    },
    "cssh": function() {
        var s0 = "hsla(";
        s0 += c.hsla[0].toString();
        s0 += ",";
        for (var i = 1; i < 3; i++) {
            s0 += c.hsla[i];
            s0 += "%,";
        }
        s0 += (c.hsla[3] / 255.0).toString();
        s0 += ")";
        return s0;
    }
}
// prototype color (base class)
// define functions (new, shuf, css)
// subclasses (rgba, hsla)
// * raw byte manipulation in ImageData
        </script>
    </head>
    <body id="alpha">
    </body>
</html>

<!--
    
    key handlers:
    <F11> - FullScreen
    <F5>  - Refresh
    keyhandlers for input?
    W,A,S,D   Up,Down,Left,Right
    Map to 8 actions
    Combinations for 8 choose N:
    N = 1 : 8
    N = 2 : 28
    N = 3 : 56
    N = 4 : 70
    Can the mind handle N > 4?

-->
