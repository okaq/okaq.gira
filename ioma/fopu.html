<!DOCTYPE html>
<html lang="en">
    <head id="zeta">
        <title>okaq</title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=1920,height=1080,initial-scale=1" />
        <meta name="source" content="https://github.com/okaq/okaq.gira" />
        <meta name="creator" content="AQ<aq@okaq.com>" />
        <meta name="date" content="2015-03-28" />
        <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAMklEQVR4nGJ51vKfgZaAiaamj1owasGoBaMWjFowasGoBaMWjFowasGoBVQEgAAAAP//6ncCrDkNKVcAAAAASUVORK5CYII=" />
        <style type="text/css">
            html,body{width:1920px;height:1080px;margin:0px;border:0px;padding:0px;background-color:rgba(255,255,255,1.0);}
        </style>
        <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
        <script type="text/javascript">
            // ok
        console.log("okaq gira ioma fopu webrtc nano!");
        // async
        (function() {
         window.addEventListener("load",function(e){g.init(e);},false);
         })();
// game
var g = {
    "init": function(e) {
        console.log(e);
        var now = window.performance.now();

        // subsystems
        g.subs = [peer,xhr,work,async];
        g.subs.forEach(function(el){el.init()});

        // click handler
        document.addEventListener("click", g.click, false);

        // stats
        var done = window.performance.now();
        var total = done - now;
        console.log("total running time " + total + "ms");
    },
    "click": function(e) {
        console.log(e);
    }
}
// peerjs
var peer = {
    "init": function() {
        peer.key = "wrcrx9bkcwlpiudi"; // peerjs cloud api key
        peer.p = new Peer({key:peer.key,debug:3});
        // console.log(peer.p);
        // id obtain from peerjs cloud
        // assign from okaq server
        peer.p.on("error", peer.error);
        peer.p.on("open", peer.open);
        peer.p.on("connection", peer.conn);
        // additional events:
        // call, close, disconnected
        // call peer.p.destroy() to clean up
    },
    "open": function(id) {
        console.log(id);
        peer.p.id = id;
        xhr.open();
    },
    "error": function(err) {
        console.log(err);
    },
    "conn": function(data) {
        console.log(data);
    }
}
// xhr
var xhr = {
    "init": function() {
        xhr.urls = [];
        xhr.req = new XMLHttpRequest();
        console.log(xhr.req);
    },
    "open": function() {
    }
}
// worker
var work = {
    "init": function() {
        work.js = 'onmessage=function(e){' +
            'console.log(e);' +
                'postMessage(Math.random());}';
        work.jsa = [work.js];
        work.blob = new Blob(work.jsa); // string to blob
        work.url = window.URL.createObjectURL(work.blob); // blob to string
        work.w = new Worker(work.url);
        work.w.onmessage = function(e) {
            console.log(e);
            var f0 = Math.random();
            console.log(" mine: " + f0 + " yours: " + e.data);
            var f1 = f0 + e.data;
            console.log(" sum: " + f1);
        }
        work.w.postMessage("ok");
        console.log(work);
    }
}
// async
var async = {
    "init": function() {
        async.p = new Promise(async.res);
        console.log(async.p);
        async.p.then(async.rep,async.err);
    },
    "res": function(resolve, reject) {
        // console.log(resolve, reject);
        var f0 = Math.random();
        if (f0 > 0.5) {
            resolve("ok all good");
        } else {
            reject(Error("something wrong"));
        }
    },
    "rep": function(response) {
        console.log(response);
    },
    "err": function(error) {
        console.log(error);
    }
}
        </script>
    </head>
    <body id="alpha">
    </body>
</html>


 
